#!/bin/bash
set -e

# Post-removal script for dcc-io-daemon

# Reload systemd after service file removal
if [ "$1" = "purge" ]; then
    systemctl daemon-reload
    
    # Optionally remove JMRI if user wants
    if [ -d /opt/jmri ] && [ -L /opt/jmri/current ]; then
        echo ""
        echo "JMRI is installed at /opt/jmri"
        read -p "Do you want to remove JMRI as well? [y/N] " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            echo "Removing JMRI installation..."
            rm -rf /opt/jmri
        else
            echo "JMRI left in place at /opt/jmri"
        fi
    fi
    
    # Clean up working directory if empty
    if [ -d /var/lib/dcc-io-daemon ]; then
        if [ -z "$(ls -A /var/lib/dcc-io-daemon)" ]; then
            echo "Removing empty working directory..."
            rmdir /var/lib/dcc-io-daemon
        fi
    fi
    
    # Remove config directory if empty
    if [ -d /etc/dcc-io-daemon ]; then
        if [ -z "$(ls -A /etc/dcc-io-daemon)" ]; then
            echo "Removing empty config directory..."
            rmdir /etc/dcc-io-daemon
        fi
    fi
fi

# DEBHELPER
exit 0

